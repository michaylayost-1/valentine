<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Valentine‚Äôs Lockbox üíò</title>
  <style>
    :root{
      --bg1:#fff1f6;
      --bg2:#f7f7ff;
      --ink:#1f1f29;
      --muted:#5c5c72;
      --pink:#ff3b8d;
      --rose:#ff5fa0;
      --purple:#7a5cff;
      --good:#14b86a;
      --bad:#ff3b3b;
      --shadow: 0 18px 40px rgba(24, 15, 56, .12);
      --shadow2: 0 10px 26px rgba(24, 15, 56, .10);
      --r: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--ink);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(255,59,141,.22), transparent 60%),
        radial-gradient(800px 520px at 80% 0%, rgba(122,92,255,.18), transparent 60%),
        radial-gradient(700px 500px at 60% 90%, rgba(255,95,160,.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    /* Floating hearts */
    .hearts{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:0;
    }
    .heart{
      position:absolute;
      bottom:-40px;
      font-size:18px;
      opacity:.45;
      animation: floatUp linear infinite;
      transform: translateX(0) rotate(0deg);
      text-shadow: 0 8px 22px rgba(255,59,141,.25);
    }
    @keyframes floatUp{
      0% { transform: translate(var(--x), 0) rotate(var(--r)); opacity: 0; }
      10%{ opacity:.45; }
      100%{ transform: translate(calc(var(--x) + var(--drift)), -120vh) rotate(calc(var(--r) + 120deg)); opacity: 0; }
    }

    .wrap{
      position:relative;
      z-index:1;
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 18px 64px;
    }
    .hero{
      background: linear-gradient(135deg, rgba(255,255,255,.82), rgba(255,255,255,.58));
      border: 1px solid rgba(255,255,255,.70);
      border-radius: calc(var(--r) + 10px);
      box-shadow: var(--shadow);
      padding: 22px 22px 18px;
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(280px 180px at 10% 10%, rgba(255,59,141,.18), transparent 70%),
        radial-gradient(320px 200px at 90% 20%, rgba(122,92,255,.16), transparent 70%),
        radial-gradient(300px 200px at 70% 90%, rgba(255,95,160,.14), transparent 70%);
      pointer-events:none;
      filter: blur(1px);
    }
    .hero > *{position:relative}

    h1{
      margin:0 0 6px;
      font-size: clamp(26px, 3.2vw, 38px);
      letter-spacing: -0.02em;
      line-height:1.1;
    }
    .loveLine{
      margin: 0 0 10px;
      font-weight: 650;
      color: rgba(255,59,141,.95);
      letter-spacing: -.01em;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .loveLine .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,59,141,.10);
      border: 1px solid rgba(255,59,141,.14);
      color: rgba(255,59,141,.98);
      font-size: 13px;
      user-select:none;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 15px;
      line-height:1.55;
      max-width: 78ch;
    }

    .codebar{
      margin-top: 16px;
      padding: 14px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255,255,255,.72);
      border-radius: 18px;
      box-shadow: var(--shadow2);
    }
    .codebarTop{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      font-size: 13px;
      color: var(--muted);
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(122,92,255,.10);
      border: 1px solid rgba(122,92,255,.14);
      user-select:none;
    }
    .progress{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
    }
    .segments{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .seg{
      display:flex;
      align-items:center;
      gap:8px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(31,31,41,.10);
      border-radius: 14px;
      padding: 10px 10px;
    }
    .seg label{
      font-size: 12px;
      color: var(--muted);
      width: 68px;
    }
    .seg input{
      width: 96px;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(31,31,41,.14);
      font-family: var(--mono);
      letter-spacing: .18em;
      text-transform: uppercase;
      outline:none;
      transition: .2s ease;
    }
    .seg input:focus{
      border-color: rgba(255,59,141,.55);
      box-shadow: 0 0 0 6px rgba(255,59,141,.10);
    }
    .seg .status{
      width: 26px;
      height: 26px;
      border-radius: 10px;
      display:grid;
      place-items:center;
      border: 1px solid rgba(31,31,41,.10);
      background: rgba(255,255,255,.9);
      font-size: 14px;
    }
    .ok{ border-color: rgba(20,184,106,.35)!important; box-shadow: 0 0 0 6px rgba(20,184,106,.12)!important;}
    .bad{ border-color: rgba(255,59,59,.40)!important; box-shadow: 0 0 0 6px rgba(255,59,59,.10)!important;}
    .status.ok{ background: rgba(20,184,106,.12); color: var(--good); }
    .status.bad{ background: rgba(255,59,59,.10); color: var(--bad); }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    button{
      appearance:none;
      border:0;
      border-radius: 14px;
      padding: 10px 14px;
      background: linear-gradient(135deg, var(--pink), var(--purple));
      color: white;
      font-weight: 800;
      letter-spacing: .01em;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(122,92,255,.20);
      transition: transform .08s ease, filter .2s ease;
    }
    button:active{ transform: translateY(1px); }
    .ghost{
      background: rgba(255,255,255,.92);
      color: var(--ink);
      border: 1px solid rgba(31,31,41,.12);
      box-shadow: none;
      font-weight: 750;
    }
    .tiny{
      font-size: 12px;
      color: var(--muted);
    }
    .musicRow{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top: 10px;
    }

    .grid{
      display:grid;
      gap: 14px;
      margin-top: 16px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.64));
      border: 1px solid rgba(255,255,255,.72);
      border-radius: var(--r);
      padding: 18px 18px 16px;
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
    }
    .card:before{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        radial-gradient(260px 160px at 15% 0%, rgba(255,59,141,.10), transparent 70%),
        radial-gradient(260px 160px at 100% 30%, rgba(122,92,255,.10), transparent 70%);
      pointer-events:none;
    }
    .card > *{ position:relative; }
    h2{
      margin: 4px 0 10px;
      font-size: 18px;
      letter-spacing: -0.01em;
    }
    .txt{ color: var(--muted); line-height:1.6; font-size: 14px; }
    .lines{
      margin: 10px 0 0;
      padding-left: 18px;
      color: var(--ink);
      line-height:1.55;
      font-size: 14px;
    }
    .lines li{ margin: 6px 0; }
    .mini{
      margin-top: 12px;
      padding: 12px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(31,31,41,.08);
      border-radius: 16px;
    }
    .miniTitle{
      font-weight: 850;
      font-size: 13px;
      margin: 0 0 8px;
      letter-spacing: .01em;
      display:flex; gap:8px; align-items:center;
    }

    /* Real wordle */
    .wordleWrap{ margin-top: 10px; }
    .wordleBoard{
      display:grid;
      gap: 8px;
      margin-top: 10px;
    }
    .wRow{ display:flex; gap:8px; }
    .tile{
      width: 42px;
      height: 44px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      font-family: var(--mono);
      font-weight: 900;
      letter-spacing: .04em;
      border: 1px solid rgba(31,31,41,.14);
      background: rgba(255,255,255,.94);
      color: rgba(31,31,41,.86);
      user-select:none;
      transition: transform .12s ease;
    }
    .tile.pop{ transform: scale(1.03); }
    .tile.gray{ background: rgba(31,31,41,.10); }
    .tile.yellow{ background: rgba(255,211,77,.55); border-color: rgba(255,211,77,.65); }
    .tile.green{ background: rgba(20,184,106,.46); border-color: rgba(20,184,106,.60); }
    .wordleControls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .wordleControls input{
      width: 160px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(31,31,41,.14);
      font-family: var(--mono);
      letter-spacing: .18em;
      text-transform: uppercase;
      outline:none;
    }
    .hintPop{
      display:none;
      margin-top: 10px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,59,141,.22);
      background: rgba(255,59,141,.10);
      color: rgba(255,59,141,.98);
      font-weight: 800;
    }

    .footer{
      margin-top: 18px;
      color: rgba(92,92,114,.9);
      font-size: 12px;
      text-align:center;
      display:flex;
      justify-content:center;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(31,31,41,.92);
      color: white;
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: .25s ease;
      z-index: 50;
      max-width: min(560px, calc(100vw - 24px));
      text-align:center;
    }
    .toast.show{ opacity: 1; }

    /* Confetti canvas */
    #confetti{
      position: fixed;
      inset:0;
      pointer-events:none;
      z-index: 40;
    }
  </style>
</head>

<body>
  <div class="hearts" aria-hidden="true" id="hearts"></div>
  <canvas id="confetti" aria-hidden="true"></canvas>

  <div class="wrap">
    <section class="hero">
      <h1>Valentine‚Äôs Lockbox üíò</h1>

      <div class="loveLine">
        <span class="badge">Happy Valentine‚Äôs Day my love! üíå</span>
        <span class="badge">Jorge + Michayla ‚ù§Ô∏è</span>
      </div>

      <p class="sub">
        I made you a virtual escape room to show you my love and appreciation. Hope you enjoy!
        <br><span class="tiny">Solve each puzzle to earn a 3-letter code chunk. Type each chunk below ‚Äî it‚Äôll glow green when correct.</span>
      </p>

      <div class="musicRow">
        <button id="musicBtn" class="ghost" type="button">‚ñ∂Ô∏é Play music</button>
      </div>

      <div class="codebar" aria-label="Code progress">
        <div class="codebarTop">
          <div class="pill">üîí 5 locks</div>
          <div class="progress"><span id="progressText">0/5 unlocked</span></div>
        </div>

        <div class="segments">
          <div class="seg">
            <label for="c1">Puzzle 1</label>
            <input id="c1" maxlength="3" placeholder="___" autocomplete="off" />
            <div class="status" id="s1">‚Ä¢</div>
          </div>
          <div class="seg">
            <label for="c2">Puzzle 2</label>
            <input id="c2" maxlength="3" placeholder="___" autocomplete="off" />
            <div class="status" id="s2">‚Ä¢</div>
          </div>
          <div class="seg">
            <label for="c3">Puzzle 3</label>
            <input id="c3" maxlength="3" placeholder="___" autocomplete="off" />
            <div class="status" id="s3">‚Ä¢</div>
          </div>
          <div class="seg">
            <label for="c4">Puzzle 4</label>
            <input id="c4" maxlength="3" placeholder="___" autocomplete="off" />
            <div class="status" id="s4">‚Ä¢</div>
          </div>
          <div class="seg">
            <label for="c5">Puzzle 5</label>
            <input id="c5" maxlength="3" placeholder="___" autocomplete="off" />
            <div class="status" id="s5">‚Ä¢</div>
          </div>
        </div>

        <div class="actions">
          <button class="ghost" id="copyFinal" type="button">Copy full code</button>
          <span class="tiny">Codes are not case-sensitive.</span>
        </div>
      </div>
    </section>

    <section class="grid" aria-label="Puzzles">

      <article class="card">
        <h2>üîê Puzzle 1 ‚Äî Memory Lock</h2>
        <p class="txt">Solve the three memories. Take the first letter of each answer, in order.</p>

        <div class="mini">
          <p class="miniTitle">Memory 1</p>
          <ul class="lines">
            <li>Where you wore the shirt I still think about.</li>
            <li>Where I made a very polite request.</li>
            <li>Talking with friends but could only think of you.</li>
          </ul>
        </div>

        <div class="mini">
          <p class="miniTitle">Memory 2</p>
          <ul class="lines">
            <li>The place where we all survived.</li>
            <li>You flipped for me, then I fell for you.</li>
            <li>Your cinematography debut deserved an award.</li>
          </ul>
        </div>

        <div class="mini">
          <p class="miniTitle">Memory 3</p>
          <ul class="lines">
            <li>The song that follows us across cities.</li>
            <li>The first thing I heard when I walked through your door.</li>
            <li>The melody that made every goodbye softer.</li>
          </ul>
        </div>
      </article>

      <article class="card">
        <h2>üîê Puzzle 2 ‚Äî You Already Heard This One</h2>
        <p class="txt">
          Go back to these three audio messages. Each clue gives you a <strong>timestamp (in seconds)</strong>.
          Jump to that second, find the <strong>word</strong> spoken at that moment, then take the <strong>first letter</strong> of that word.
          Combine the three letters to get your code chunk.
        </p>
        <ul class="lines">
          <li>Saturday 2/7 ‚Äî 10:54 PM</li>
          <li>Sunday 2/8 ‚Äî 8:47 PM</li>
          <li>Thursday 2/12 ‚Äî 9:02 PM</li>
        </ul>

        <div class="mini">
          <p class="miniTitle">Audio 1 (timestamp clue)</p>
          <p class="txt" style="margin:0">The number of letters in the city where we first met.</p>
        </div>
        <div class="mini">
          <p class="miniTitle">Audio 2 (timestamp clue)</p>
          <p class="txt" style="margin:0">The number of hours in half a day‚Ä¶ plus one (because you‚Äôre my number 1).</p>
        </div>
        <div class="mini">
          <p class="miniTitle">Audio 3 (timestamp clue)</p>
          <p class="txt" style="margin:0">The age of my brother.</p>
        </div>
      </article>

      <article class="card">
        <h2>üîê Puzzle 3 ‚Äî Wordle</h2>
        <p class="txt">Guess the 5-letter word. Green = right letter, right place. Yellow = right letter, wrong place. Gray = not in the word. When you solve it, take the last three letters for your code chunk.</p>

        <div class="mini">
          <p class="miniTitle">Play</p>

          <div class="wordleWrap">
            <div class="wordleBoard" id="wordleBoard" aria-label="Wordle board"></div>

            <div class="wordleControls">
              <input id="wordleGuess" maxlength="5" placeholder="TYPE GUESS" autocomplete="off" />
              <button id="wordleSubmit" type="button">Submit</button>
              <span class="tiny" id="wordleTries">0/5 tries</span>
            </div>

            <div class="hintPop" id="wordleHint">It‚Äôs what you are to me.</div>
            <div class="tiny" id="wordleResult" style="margin-top:8px"></div>
          </div>
        </div>
      </article>

      <article class="card">
        <h2>üîê Puzzle 4 ‚Äî Follow the Compass</h2>
        <p class="txt">
          Some answers require direction. Think like a compass.
          For each selfie: use the riddle to choose <strong>North / East / South / West</strong>, then take the letter hidden in that corner.
        </p>

        <ul class="lines">
          <li>Selfie from Thursday 2/12 ‚Äî <strong>10:56 PM</strong></li>
          <li>Selfie from Thursday 2/12 ‚Äî <strong>10:59 PM</strong></li>
          <li>Selfie from Thursday 2/12 ‚Äî <strong>11:02 PM</strong></li>
        </ul>

        <div class="mini">
          <p class="miniTitle">Selfie 1 (direction riddle)</p>
          <ul class="lines">
            <li>Longer coats, earlier sunsets.</li>
            <li>Maps trust me.</li>
            <li>Where winter shows up first.</li>
          </ul>
        </div>

        <div class="mini">
          <p class="miniTitle">Selfie 2 (direction riddle)</p>
          <ul class="lines">
            <li>Starting to heat up.</li>
            <li>The direction where latitude gets smaller.</li>
            <li>Where snowbirds go in January.</li>
          </ul>
        </div>

        <div class="mini">
          <p class="miniTitle">Selfie 3 (direction riddle)</p>
          <ul class="lines">
            <li>Go the way time zones advance (your clock jumps forward).</li>
            <li>On my way to see you.</li>
            <li>It‚Äôs the direction where new calendar days arrive first.</li>
          </ul>
        </div>
      </article>

      <article class="card">
        <h2>üîê Puzzle 5 ‚Äî Logic Trio</h2>
        <p class="txt">
          Solve each riddle. For each answer, write the number as a word, then take the first letter.
          <span class="tiny">(Example: <strong>Eighty</strong> ‚Üí <strong>E</strong>)</span>
        </p>

        <div class="mini">
          <p class="miniTitle">1) The weight riddle</p>
          <ul class="lines">
            <li>Elephant + 2 crocodiles = 1,200 kg</li>
            <li>2 crocodiles + 4 monkeys = 400 kg</li>
            <li>Elephant + 4 monkeys = 1,000 kg</li>
          </ul>
          <p class="txt" style="margin:8px 0 0">What is the weight of the elephant?</p>
        </div>

        <div class="mini">
          <p class="miniTitle">2) The farm puzzle</p>
          <p class="txt" style="margin:0">On a farm there are ducks and cows. There are 18 legs and 7 heads total. How many ducks are there?</p>
        </div>

        <div class="mini">
          <p class="miniTitle">3) The fish riddle</p>
          <p class="txt" style="margin:0">A fish‚Äôs head is 3 cm. Its tail is the same length as the head plus half the body. The body is as long as the head and tail together. How long is the fish?</p>
        </div>
      </article>

    </section>

    <div class="footer">
      <span>Made with love üíò</span>
      <span>‚Ä¢</span>
      <span>Jorge + Michayla ‚ù§Ô∏è</span>
    </div>
  </div>

  <div class="toast" id="toast">Copied!</div>

  <script>
    const ANSWERS = { c1:"KPN", c2:"KHE", c3:"BBY", c4:"ILG", c5:"NFT" };

    (function makeHearts(){
      const container = document.getElementById("hearts");
      const hearts = ["üíó","üíñ","üíò","üíû","üíï","üíù"];
      for(let i=0;i<18;i++){
        const h = document.createElement("div");
        h.className = "heart";
        h.textContent = hearts[Math.floor(Math.random()*hearts.length)];
        const left = Math.random()*100;
        const dur = 10 + Math.random()*10;
        const delay = Math.random()*6;
        const size = 14 + Math.random()*18;
        const drift = (Math.random()*60 - 30) + "px";
        const x = (Math.random()*40 - 20) + "px";
        const rot = (Math.random()*80 - 40) + "deg";
        h.style.left = left + "vw";
        h.style.fontSize = size + "px";
        h.style.animationDuration = dur + "s";
        h.style.animationDelay = (-delay) + "s";
        h.style.setProperty("--drift", drift);
        h.style.setProperty("--x", x);
        h.style.setProperty("--r", rot);
        container.appendChild(h);
      }
    })();

    const inputs = ["c1","c2","c3","c4","c5"].map(id => document.getElementById(id));
    const statuses = {
      c1: document.getElementById("s1"),
      c2: document.getElementById("s2"),
      c3: document.getElementById("s3"),
      c4: document.getElementById("s4"),
      c5: document.getElementById("s5"),
    };
    const progressText = document.getElementById("progressText");

    function normalize(v){ return (v||"").toUpperCase().replace(/[^A-Z]/g,"").slice(0,3); }

    function setStatus(id, state){
      const input = document.getElementById(id);
      const st = statuses[id];
      input.classList.remove("ok","bad");
      st.classList.remove("ok","bad");
      if(state === "ok"){
        input.classList.add("ok"); st.classList.add("ok"); st.textContent = "‚úì";
      } else if(state === "bad"){
        input.classList.add("bad"); st.classList.add("bad"); st.textContent = "‚úï";
      } else { st.textContent = "‚Ä¢"; }
    }

    let unlockedOnce = false;
    function recompute(){
      let correct = 0;
      for(const id of Object.keys(ANSWERS)){
        const input = document.getElementById(id);
        const val = normalize(input.value);
        input.value = val;
        if(val.length === 3){
          if(val === ANSWERS[id]){ setStatus(id,"ok"); correct++; }
          else { setStatus(id,"bad"); }
        } else { setStatus(id,null); }
      }
      progressText.textContent = `${correct}/5 unlocked`;
      if(correct === 5 && !unlockedOnce){
        unlockedOnce = true;
        confettiBurst();
        showToast("Yay you did it!! My hubby is so smart. Hope you had fun <3");
      }
    }
    inputs.forEach(inp => { inp.addEventListener("input", recompute); inp.addEventListener("blur", recompute); });

    const toast = document.getElementById("toast");
    function showToast(msg="Copied!"){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 1800);
    }

    document.getElementById("copyFinal").addEventListener("click", async () => {
      const full = `${normalize(c1.value)}-${normalize(c2.value)}-${normalize(c3.value)}-${normalize(c4.value)}-${normalize(c5.value)}`;
      try{ await navigator.clipboard.writeText(full); showToast("Copied full code!"); }
      catch(e){ showToast("Copy not supported here"); }
    });

    // Wordle
    const WORD = "HUBBY";
    const maxTries = 5;
    let tries = 0, solved = false;

    const boardEl = document.getElementById("wordleBoard");
    const guessInput = document.getElementById("wordleGuess");
    const submitBtn = document.getElementById("wordleSubmit");
    const triesLabel = document.getElementById("wordleTries");
    const hintPop = document.getElementById("wordleHint");
    const result = document.getElementById("wordleResult");
    const code3 = document.getElementById("c3");

    const tiles = [];
    for(let r=0;r<maxTries;r++){
      const row = document.createElement("div"); row.className = "wRow";
      const rowTiles = [];
      for(let c=0;c<5;c++){
        const t = document.createElement("div"); t.className = "tile"; t.textContent = "";
        row.appendChild(t); rowTiles.push(t);
      }
      boardEl.appendChild(row);
      tiles.push(rowTiles);
    }

    function evaluateGuess(guess, answer){
      const res = Array(5).fill("gray");
      const a = answer.split("");
      const g = guess.split("");
      for(let i=0;i<5;i++){
        if(g[i] === a[i]){ res[i] = "green"; a[i]=null; g[i]=null; }
      }
      for(let i=0;i<5;i++){
        if(g[i] === null) continue;
        const idx = a.indexOf(g[i]);
        if(idx !== -1){ res[i] = "yellow"; a[idx]=null; }
      }
      return res;
    }
    function renderRow(rowIndex, guess, colors){
      for(let i=0;i<5;i++){
        const t = tiles[rowIndex][i];
        t.textContent = guess[i] || "";
        t.classList.remove("green","yellow","gray","pop");
        t.classList.add(colors[i] || "");
        requestAnimationFrame(()=>t.classList.add("pop"));
        setTimeout(()=>t.classList.remove("pop"), 140);
      }
    }
    function finishWordle(){
      code3.value = "BBY";
      recompute();
      solved = true;
      guessInput.disabled = true;
      submitBtn.disabled = true;
    }
    function setWordleHint(show){ hintPop.style.display = show ? "block" : "none"; }

    submitBtn.addEventListener("click", () => {
      if(solved) return;
      const guess = (guessInput.value||"").toUpperCase().replace(/[^A-Z]/g,"").slice(0,5);
      guessInput.value = guess;
      if(guess.length !== 5) return;

      const colors = evaluateGuess(guess, WORD);
      renderRow(tries, guess, colors);

      tries++;
      triesLabel.textContent = `${tries}/${maxTries} tries`;

      if(guess === WORD){
        result.textContent = "‚úÖ Nice. Now take the last three letters.";
        setWordleHint(false);
        finishWordle();
        return;
      }
      if(tries >= 4) setWordleHint(true);
      result.textContent = (tries >= maxTries) ? "Out of tries ‚Äî read the hint and you‚Äôll get it." : "Not quite ‚Äî try again.";
      guessInput.select();
    });
    guessInput.addEventListener("keydown", (e)=>{ if(e.key==="Enter") submitBtn.click(); });

    // Confetti
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    let confetti = [];
    let confettiOn = false;

    function resize(){
      canvas.width = window.innerWidth * devicePixelRatio;
      canvas.height = window.innerHeight * devicePixelRatio;
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    window.addEventListener("resize", resize);
    resize();

    function confettiBurst(){
      const count = 220;
      confetti = [];
      for(let i=0;i<count;i++){
        confetti.push({
          x: Math.random()*window.innerWidth,
          y: -20 - Math.random()*window.innerHeight*0.2,
          vx: (Math.random()*2 - 1) * 3,
          vy: 2 + Math.random()*4,
          r: 4 + Math.random()*6,
          a: 0.6 + Math.random()*0.4,
          spin: (Math.random()*2 - 1) * 0.2,
          rot: Math.random()*Math.PI*2,
          life: 200 + Math.random()*120
        });
      }
      confettiOn = true;
      animateConfetti();
    }

    function animateConfetti(){
      if(!confettiOn) return;
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      confetti.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.rot += p.spin;
        p.vx *= 0.995; p.vy *= 0.99; p.life -= 1;

        ctx.save();
        ctx.globalAlpha = p.a;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);

        ctx.beginPath();
        const s = p.r;
        ctx.moveTo(0, s/2);
        ctx.bezierCurveTo(0, 0, -s, 0, -s, s/2);
        ctx.bezierCurveTo(-s, s, 0, s*1.2, 0, s*1.45);
        ctx.bezierCurveTo(0, s*1.2, s, s, s, s/2);
        ctx.bezierCurveTo(s, 0, 0, 0, 0, s/2);

        const t = (p.x + p.y) % 3;
        ctx.fillStyle = t < 1 ? "rgba(255,59,141,.95)" : (t < 2 ? "rgba(255,95,160,.95)" : "rgba(122,92,255,.95)");
        ctx.fill();
        ctx.restore();
      });

      confetti = confetti.filter(p=>p.life > 0 && p.y < window.innerHeight + 40);

      if(confetti.length){
        requestAnimationFrame(animateConfetti);
      } else {
        confettiOn = false;
        ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
      }
    }

    // Music (WebAudio gentle piano-ish loop)
    let audioCtx = null;
    let musicOn = false;
    let musicTimer = null;

    function ensureAudio(){
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    function playNote(freq, when, dur, gain=0.10){
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = "sine";
      o.frequency.setValueAtTime(freq, when);
      g.gain.setValueAtTime(0.0001, when);
      g.gain.exponentialRampToValueAtTime(gain, when + 0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, when + dur);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(when); o.stop(when + dur + 0.02);
    }
    function startMusic(){
      ensureAudio();
      if(audioCtx.state === "suspended") audioCtx.resume();
      musicOn = true;
      document.getElementById("musicBtn").textContent = "‚è∏ Pause music";

      const base = 220;
      const scale = [0, 3, 7, 10, 12, 15, 19];
      let step = 0;

      musicTimer = setInterval(()=>{
        if(!musicOn) return;
        const now = audioCtx.currentTime;
        const s1 = scale[step % scale.length];
        const s2 = scale[(step+2) % scale.length];
        const s3 = scale[(step+4) % scale.length];

        playNote(base * Math.pow(2, s1/12), now + 0.00, 0.55, 0.06);
        playNote(base * Math.pow(2, s2/12), now + 0.08, 0.55, 0.05);
        playNote(base * Math.pow(2, s3/12), now + 0.16, 0.65, 0.045);

        if(step % 6 === 0){
          playNote(base * 2 * Math.pow(2, scale[(step+1)%scale.length]/12), now + 0.20, 0.35, 0.03);
        }
        step++;
      }, 650);
    }
    function stopMusic(){
      musicOn = false;
      document.getElementById("musicBtn").textContent = "‚ñ∂Ô∏é Play music";
      if(musicTimer) clearInterval(musicTimer);
      musicTimer = null;
    }
    document.getElementById("musicBtn").addEventListener("click", ()=>{
      if(!musicOn){ startMusic(); showToast("Music on üé∂"); }
      else { stopMusic(); showToast("Music paused"); }
    });

    recompute();
  </script>
</body>
</html>
